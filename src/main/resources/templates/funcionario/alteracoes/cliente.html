<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Alterar Dados do Cliente - Banco Malvader</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .form-container {
            max-width: 800px;
            margin: 2rem auto;
            background: #fff;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }
        .form-title {
            text-align: center;
            margin-bottom: 2rem;
            border-bottom: 2px solid #f39c12;
            padding-bottom: 1rem;
        }
        .btn-warning {
            background-color: #f39c12;
            border-color: #f39c12;
            font-weight: 600;
            color: white;
        }
        .btn-warning:hover {
            background-color: #d68910;
            border-color: #d68910;
            color: white;
        }
        .icon-header {
            font-size: 2rem;
            color: #f39c12;
            margin-bottom: 0.5rem;
        }
        .alert {
            border-radius: 8px;
        }
        .form-section {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }
        .client-info {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .changes-preview {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }
    </style>
</head>
<body>

<div class="form-container">
    <div class="form-title">
        <i class="fas fa-user-edit icon-header"></i>
        <h4>Alteração de Dados do Cliente</h4>
        <p class="text-muted">Atualize informações pessoais dos clientes</p>
    </div>

    <!-- Mensagens -->
    <div th:if="${sucesso}" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle me-2"></i>
        <span th:text="${sucesso}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div th:if="${erro}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-triangle me-2"></i>
        <span th:text="${erro}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <form action="/funcionario/alteracoes/cliente" method="post">

        <!-- Busca do Cliente -->
        <div class="form-section">
            <h5 class="mb-3"><i class="fas fa-search me-2"></i>Buscar Cliente</h5>

            <div class="row">
                <div class="col-md-8 mb-3">
                    <label for="cpfCliente" class="form-label">CPF do Cliente *</label>
                    <input type="text" class="form-control" id="cpfCliente" name="cpfCliente" required
                           placeholder="Digite o CPF do cliente"
                           pattern="[0-9]{11}" title="Digite 11 números">
                </div>
                <div class="col-md-4 d-flex align-items-end">
                    <button type="button" class="btn btn-outline-primary w-100" onclick="buscarCliente()">
                        <i class="fas fa-search me-1"></i>Buscar
                    </button>
                </div>
            </div>
        </div>

        <!-- Informações do Cliente -->
        <div id="clientInfo" class="client-info" style="display: none;">
            <h5><i class="fas fa-user me-2"></i>Dados do Cliente</h5>
            <div class="row">
                <div class="col-md-6">
                    <table class="table table-sm">
                        <tr>
                            <td><strong>Nome:</strong></td>
                            <td id="infoNome">-</td>
                        </tr>
                        <tr>
                            <td><strong>CPF:</strong></td>
                            <td id="infoCpf">-</td>
                        </tr>
                        <tr>
                            <td><strong>Data Nasc.:</strong></td>
                            <td id="infoNascimento">-</td>
                        </tr>
                    </table>
                </div>
                <div class="col-md-6">
                    <table class="table table-sm">
                        <tr>
                            <td><strong>Score:</strong></td>
                            <td id="infoScore">-</td>
                        </tr>
                        <tr>
                            <td><strong>Contas:</strong></td>
                            <td id="infoContas">-</td>
                        </tr>
                        <tr>
                            <td><strong>Status:</strong></td>
                            <td><span class="badge bg-success">ATIVO</span></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <!-- Dados para Alteração -->
        <div class="form-section">
            <h5 class="mb-3"><i class="fas fa-edit me-2"></i>Dados para Alteração</h5>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="novoTelefone" class="form-label">Novo Telefone</label>
                    <input type="tel" class="form-control" id="novoTelefone" name="novoTelefone"
                           placeholder="(00) 00000-0000">
                    <div class="form-text">Deixe em branco para manter o atual</div>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="novoEmail" class="form-label">Novo E-mail</label>
                    <input type="email" class="form-control" id="novoEmail" name="novoEmail"
                           placeholder="cliente@email.com">
                </div>
            </div>

            <h6 class="mt-4 mb-3">Endereço</h6>
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label for="novoCep" class="form-label">CEP</label>
                    <input type="text" class="form-control" id="novoCep" name="novoCep"
                           placeholder="00000-000">
                </div>
                <div class="col-md-6 mb-3">
                    <label for="novoLogradouro" class="form-label">Logradouro</label>
                    <input type="text" class="form-control" id="novoLogradouro" name="novoLogradouro"
                           placeholder="Rua, Avenida, etc.">
                </div>
                <div class="col-md-3 mb-3">
                    <label for="novoNumero" class="form-label">Número</label>
                    <input type="text" class="form-control" id="novoNumero" name="novoNumero"
                           placeholder="000">
                </div>
            </div>

            <div class="row">
                <div class="col-md-5 mb-3">
                    <label for="novoBairro" class="form-label">Bairro</label>
                    <input type="text" class="form-control" id="novoBairro" name="novoBairro">
                </div>
                <div class="col-md-5 mb-3">
                    <label for="novaCidade" class="form-label">Cidade</label>
                    <input type="text" class="form-control" id="novaCidade" name="novaCidade">
                </div>
                <div class="col-md-2 mb-3">
                    <label for="novoEstado" class="form-label">Estado</label>
                    <input type="text" class="form-control" id="novoEstado" name="novoEstado" maxlength="2"
                           placeholder="UF">
                </div>
            </div>

            <div class="mb-3">
                <label for="novoComplemento" class="form-label">Complemento</label>
                <input type="text" class="form-control" id="novoComplemento" name="novoComplemento"
                       placeholder="Apartamento, bloco, etc.">
            </div>
        </div>

        <!-- Alteração de Senha -->
        <div class="form-section">
            <h5 class="mb-3"><i class="fas fa-key me-2"></i>Alteração de Senha</h5>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="novaSenha" class="form-label">Nova Senha</label>
                    <input type="password" class="form-control" id="novaSenha" name="novaSenha"
                           placeholder="Deixe em branco para manter a atual"
                           minlength="8">
                    <div class="form-text">Mínimo 8 caracteres</div>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="confirmarSenha" class="form-label">Confirmar Senha</label>
                    <input type="password" class="form-control" id="confirmarSenha" name="confirmarSenha"
                           placeholder="Confirme a nova senha">
                    <div class="form-text" id="passwordMatch"></div>
                </div>
            </div>
        </div>

        <div class="mb-3">
            <label for="justificativa" class="form-label">Justificativa da Alteração *</label>
            <textarea class="form-control" id="justificativa" name="justificativa" rows="3" required
                      placeholder="Descreva o motivo das alterações..."></textarea>
        </div>

        <div class="form-check mb-4">
            <input class="form-check-input" type="checkbox" id="confirmacao" required>
            <label class="form-check-label" for="confirmacao">
                Confirmo que as informações estão corretas e o cliente autorizou as alterações
            </label>
        </div>

        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
            <a href="/funcionario/alteracoes" class="btn btn-secondary me-md-2">
                <i class="fas fa-arrow-left me-1"></i>Cancelar
            </a>
            <button type="submit" class="btn btn-warning" id="btnAlterar" disabled>
                <i class="fas fa-check-circle me-1"></i>Atualizar Dados
            </button>
        </div>
    </form>
</div>

<script>
    // Simulação de busca de cliente
    function buscarCliente() {
        const cpf = document.getElementById('cpfCliente').value;
        if (cpf.length === 11) {
            document.getElementById('clientInfo').style.display = 'block';
            document.getElementById('infoNome').textContent = 'João da Silva';
            document.getElementById('infoCpf').textContent = cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
            document.getElementById('infoNascimento').textContent = '15/03/1985';
            document.getElementById('infoScore').textContent = '75.5 pontos';
            document.getElementById('infoContas').textContent = '3 contas ativas';

            // Preencher campos atuais
            document.getElementById('novoTelefone').placeholder = '(61) 99999-9999';
        }
    }

    // Verificar se senhas coincidem
    document.getElementById('confirmarSenha').addEventListener('input', function() {
        const senha = document.getElementById('novaSenha').value;
        const confirmar = this.value;
        const matchElement = document.getElementById('passwordMatch');

        if (senha && confirmar && senha !== confirmar) {
            matchElement.textContent = 'As senhas não coincidem';
            matchElement.className = 'form-text text-danger';
        } else if (senha && confirmar && senha === confirmar) {
            matchElement.textContent = 'Senhas coincidem';
            matchElement.className = 'form-text text-success';
        } else {
            matchElement.textContent = '';
        }
    });

    // Habilitar botão de alteração
    document.getElementById('confirmacao').addEventListener('change', function() {
        const cpfCliente = document.getElementById('cpfCliente').value;
        const justificativa = document.getElementById('justificativa').value;
        const confirmacao = this.checked;

        const senha = document.getElementById('novaSenha').value;
        const confirmarSenha = document.getElementById('confirmarSenha').value;
        const senhasOk = !senha || (senha && confirmarSenha && senha === confirmarSenha);

        document.getElementById('btnAlterar').disabled = !(cpfCliente && justificativa && confirmacao && senhasOk);
    });

    // Buscar CEP
    document.getElementById('novoCep').addEventListener('blur', function() {
        const cep = this.value.replace(/\D/g, '');
        if (cep.length === 8) {
            // Simulação de busca de CEP
            document.getElementById('novoLogradouro').value = 'Rua das Flores';
            document.getElementById('novoBairro').value = 'Centro';
            document.getElementById('novaCidade').value = 'Brasília';
            document.getElementById('novoEstado').value = 'DF';
        }
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Cadastrar Funcionário - Banco Malvader</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .form-container {
            max-width: 800px;
            margin: 2rem auto;
            background: #fff;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }
        .form-title {
            text-align: center;
            margin-bottom: 2rem;
            border-bottom: 2px solid #f39c12;
            padding-bottom: 1rem;
        }
        .btn-warning {
            background-color: #f39c12;
            border-color: #f39c12;
            font-weight: 600;
            color: white;
        }
        .btn-warning:hover {
            background-color: #d68910;
            border-color: #d68910;
            color: white;
        }
        .icon-header {
            font-size: 2rem;
            color: #f39c12;
            margin-bottom: 0.5rem;
        }
        .alert {
            border-radius: 8px;
        }
        .form-section {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }
        .permission-alert {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }
    </style>
</head>
<body>

<div class="form-container">
    <div class="form-title">
        <i class="fas fa-user-plus icon-header"></i>
        <h4>Cadastro de Funcionário</h4>
        <p class="text-muted">Cadastre novos colaboradores no sistema</p>
    </div>

    <!-- Alerta de Permissão -->
    <div class="permission-alert">
        <h6><i class="fas fa-shield-alt text-warning me-2"></i>Acesso Restrito</h6>
        <p class="mb-0">Esta funcionalidade está disponível apenas para usuários com perfil de <strong>Gerente</strong>.</p>
    </div>

    <!-- Mensagens -->
    <div th:if="${sucesso}" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle me-2"></i>
        <span th:text="${sucesso}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div th:if="${erro}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-triangle me-2"></i>
        <span th:text="${erro}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <form th:action="@{/funcionario/funcionarios/cadastrar}" method="post">

        <!-- Dados Pessoais -->
        <div class="form-section">
            <h5 class="mb-3"><i class="fas fa-id-card me-2"></i>Dados Pessoais</h5>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="nome" class="form-label">Nome Completo *</label>
                    <input type="text" class="form-control" id="nome" name="nome" required
                           placeholder="Digite o nome completo">
                </div>
                <div class="col-md-6 mb-3">
                    <label for="cpf" class="form-label">CPF *</label>
                    <input type="text" class="form-control" id="cpf" name="cpf" required
                           placeholder="000.000.000-00" pattern="[0-9]{11}">
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="dataNascimento" class="form-label">Data de Nascimento *</label>
                    <input type="date" class="form-control" id="dataNascimento" name="dataNascimento" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="telefone" class="form-label">Telefone *</label>
                    <input type="tel" class="form-control" id="telefone" name="telefone" required
                           placeholder="(00) 00000-0000">
                </div>
            </div>
        </div>

        <!-- Dados Profissionais -->
        <div class="form-section">
            <h5 class="mb-3"><i class="fas fa-briefcase me-2"></i>Dados Profissionais</h5>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="cargo" class="form-label">Cargo *</label>
                    <select class="form-select" id="cargo" name="cargo" required>
                        <option value="">Selecione o cargo</option>
                        <option value="ESTAGIARIO">Estagiário</option>
                        <option value="ATENDENTE">Atendente</option>
                        <option value="GERENTE">Gerente</option>
                    </select>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="idAgencia" class="form-label">Agência *</label>
                    <select class="form-select" id="idAgencia" name="idAgencia" required>
                        <option value="">Selecione a agência</option>
                        <option th:each="agencia : ${agencias}"
                                th:value="${agencia.idAgencia}"
                                th:text="${agencia.nome + ' - ' + agencia.codigoAgencia}">
                        </option>
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="codigoFuncionario" class="form-label">Código do Funcionário</label>
                    <input type="text" class="form-control" id="codigoFuncionario" name="codigoFuncionario"
                           placeholder="Será gerado automaticamente" readonly>
                    <div class="form-text">Código único gerado pelo sistema</div>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="idSupervisor" class="form-label">Supervisor</label>
                    <select class="form-select" id="idSupervisor" name="idSupervisor">
                        <option value="">Sem supervisor</option>
                        <option value="1">Gerente Principal</option>
                        <option value="2">Supervisor Comercial</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Dados de Acesso -->
        <div class="form-section">
            <h5 class="mb-3"><i class="fas fa-key me-2"></i>Dados de Acesso</h5>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="senha" class="form-label">Senha *</label>
                    <input type="password" class="form-control" id="senha" name="senha" required
                           placeholder="Digite a senha" minlength="8">
                    <div class="form-text">Mínimo 8 caracteres</div>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="confirmarSenha" class="form-label">Confirmar Senha *</label>
                    <input type="password" class="form-control" id="confirmarSenha" name="confirmarSenha" required
                           placeholder="Confirme a senha">
                    <div class="form-text" id="passwordMatch"></div>
                </div>
            </div>

            <div class="mb-3">
                <label for="email" class="form-label">E-mail</label>
                <input type="email" class="form-control" id="email" name="email"
                       placeholder="funcionario@bancomalvader.com">
            </div>
        </div>

        <!-- Endereço -->
        <div class="form-section">
            <h5 class="mb-3"><i class="fas fa-home me-2"></i>Endereço</h5>

            <div class="row">
                <div class="col-md-3 mb-3">
                    <label for="cep" class="form-label">CEP</label>
                    <input type="text" class="form-control" id="cep" name="cep"
                           placeholder="00000-000">
                </div>
                <div class="col-md-6 mb-3">
                    <label for="logradouro" class="form-label">Logradouro</label>
                    <input type="text" class="form-control" id="logradouro" name="logradouro"
                           placeholder="Rua, Avenida, etc.">
                </div>
                <div class="col-md-3 mb-3">
                    <label for="numero" class="form-label">Número</label>
                    <input type="text" class="form-control" id="numero" name="numero"
                           placeholder="000">
                </div>
            </div>

            <div class="row">
                <div class="col-md-5 mb-3">
                    <label for="bairro" class="form-label">Bairro</label>
                    <input type="text" class="form-control" id="bairro" name="bairro">
                </div>
                <div class="col-md-5 mb-3">
                    <label for="cidade" class="form-label">Cidade</label>
                    <input type="text" class="form-control" id="cidade" name="cidade">
                </div>
                <div class="col-md-2 mb-3">
                    <label for="estado" class="form-label">Estado</label>
                    <input type="text" class="form-control" id="estado" name="estado" maxlength="2"
                           placeholder="UF">
                </div>
            </div>

            <div class="mb-3">
                <label for="complemento" class="form-label">Complemento</label>
                <input type="text" class="form-control" id="complemento" name="complemento"
                       placeholder="Apartamento, bloco, etc.">
            </div>
        </div>

        <div class="form-check mb-4">
            <input class="form-check-input" type="checkbox" id="confirmacao" required>
            <label class="form-check-label" for="confirmacao">
                Confirmo que todas as informações estão corretas e autorizo o cadastro
            </label>
        </div>

        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
            <a href="/funcionario/dashboard" class="btn btn-secondary me-md-2">
                <i class="fas fa-arrow-left me-1"></i>Cancelar
            </a>
            <button type="submit" class="btn btn-warning" id="btnCadastrar" disabled>
                <i class="fas fa-user-plus me-1"></i>Cadastrar Funcionário
            </button>
        </div>
    </form>
</div>

<script>
    // Gerar código do funcionário
    function gerarCodigoFuncionario() {
        const prefixo = 'FUNC';
        const timestamp = new Date().getTime().toString().slice(-6);
        const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
        document.getElementById('codigoFuncionario').value = prefixo + timestamp + random;
    }

    // Verificar se senhas coincidem
    document.getElementById('confirmarSenha').addEventListener('input', function() {
        const senha = document.getElementById('senha').value;
        const confirmar = this.value;
        const matchElement = document.getElementById('passwordMatch');

        if (confirmar && senha !== confirmar) {
            matchElement.textContent = 'As senhas não coincidem';
            matchElement.className = 'form-text text-danger';
        } else if (confirmar && senha === confirmar) {
            matchElement.textContent = 'Senhas coincidem';
            matchElement.className = 'form-text text-success';
        } else {
            matchElement.textContent = '';
        }
    });

    // Habilitar botão de cadastro
    document.getElementById('confirmacao').addEventListener('change', function() {
        const requiredFields = document.querySelectorAll('input[required], select[required]');
        let allFilled = true;

        requiredFields.forEach(field => {
            if (!field.value) allFilled = false;
        });

        const senha = document.getElementById('senha').value;
        const confirmarSenha = document.getElementById('confirmarSenha').value;
        const senhasOk = senha && confirmarSenha && senha === confirmarSenha;

        document.getElementById('btnCadastrar').disabled = !(allFilled && senhasOk && this.checked);
    });

    // Buscar CEP (exemplo simplificado)
    document.getElementById('cep').addEventListener('blur', function() {
        const cep = this.value.replace(/\D/g, '');
        if (cep.length === 8) {
            // Simulação de busca de CEP
            document.getElementById('logradouro').value = 'Rua Exemplo';
            document.getElementById('bairro').value = 'Centro';
            document.getElementById('cidade').value = 'Brasília';
            document.getElementById('estado').value = 'DF';
        }
    });

    // Gerar código ao carregar a página
    document.addEventListener('DOMContentLoaded', gerarCodigoFuncionario);
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
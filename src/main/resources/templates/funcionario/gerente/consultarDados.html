<!DOCTYPE html>
<html lang="pt-BR"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Consultar Dados - Banco Malvader</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        body {
            background-color: #f4f6f9;
            font-family: 'Segoe UI', sans-serif;
        }

        .container {
            max-width: 1000px;
            margin: 40px auto;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }

        .nav-tabs .nav-link.active {
            background-color: #3498db;
            color: white;
            border: none;
        }

        .nav-tabs .nav-link {
            color: #3498db;
            font-weight: 600;
        }

        .tab-content {
            margin-top: 20px;
        }

        label {
            font-weight: bold;
            margin-top: 15px;
        }

        .form-control {
            margin-bottom: 10px;
        }

        .section-title {
            margin-top: 30px;
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .table {
            margin-top: 15px;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Consultar Dados</h2>

    <!-- Submenu Tabs -->
    <ul class="nav nav-tabs" id="consultaTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link"
                    id="conta-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#conta"
                    type="button"
                    role="tab"
                    th:classappend="${aba == 'conta' or aba == null} ? ' active' : ''">
                Conta
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link"
                    id="funcionario-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#funcionario"
                    type="button"
                    role="tab"
                    th:classappend="${aba == 'funcionario'} ? ' active' : ''">
                Funcionário
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link"
                    id="cliente-tab"
                    data-bs-toggle="tab"
                    data-bs-target="#cliente"
                    type="button"
                    role="tab"
                    th:classappend="${aba == 'cliente'} ? ' active' : ''">
                Cliente
            </button>
        </li>
    </ul>

    <div class="tab-content" id="consultaTabsContent">
        <!-- CONTA -->
        <div class="tab-pane fade"
             id="conta"
             role="tabpanel"
             th:classappend="${aba == 'conta' or aba == null} ? ' show active' : ''">

            <!-- Form de busca pelo número da conta -->
            <form th:action="@{/atendente/consultar-saldo}" method="get" class="row g-2 mb-3">
                <input type="hidden" name="aba" value="conta"/>
                <div class="col-md-4">
                    <label>Número da Conta</label>
                    <input type="text"
                           class="form-control"
                           name="numeroConta"
                           th:value="${param.numeroConta}">
                </div>
                <div class="col-md-3 d-flex align-items-end">
                    <button class="btn btn-primary w-100" type="submit">Buscar</button>
                </div>
            </form>

            <!-- Mensagem de erro (quando não encontra conta) -->
            <div th:if="${mensagemErro}" class="alert alert-danger">
                <span th:text="${mensagemErro}"></span>
            </div>

            <!-- Só mostra os dados se a conta foi encontrada -->
            <div th:if="${conta != null}">
                <label>Tipo de Conta</label>
                <input type="text" class="form-control" readonly
                       th:value="${conta.tipoConta}">

                <label>Nome</label>
                <input type="text" class="form-control" readonly
                       th:value="${conta.cliente.usuario.nome}">

                <label>CPF</label>
                <input type="text" class="form-control" readonly
                       th:value="${conta.cliente.usuario.cpf}">

                <label>Saldo Atual</label>
                <input type="text" class="form-control" readonly
                       th:value="${conta.saldo}">

                <label>Limite Disponível</label>
                <input type="text" class="form-control" readonly
                       th:value="${contaCorrente != null ? contaCorrente.limite : ''}">

                <label>Data de Vencimento</label>
                <input type="date" class="form-control" readonly
                       th:value="${contaCorrente != null ? contaCorrente.dataVencimento : null}">

                <div class="section-title">Histórico de Transações</div>
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th>Data</th>
                        <th>Tipo</th>
                        <th>Valor</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- futuro: iterar sobre transações -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- FUNCIONÁRIO -->
        <div class="tab-pane fade"
             id="funcionario"
             role="tabpanel"
             th:classappend="${aba == 'funcionario'} ? ' show active' : ''">

            <!-- Form de busca do funcionário -->
            <form th:action="@{/atendente/consultar-saldo}" method="get" class="row g-2 mb-3">
                <input type="hidden" name="aba" value="funcionario"/>
                <div class="col-md-3">
                    <label>Código do Funcionário</label>
                    <input type="text"
                           class="form-control"
                           name="codigoFuncionario"
                           th:value="${param.codigoFuncionario}">
                </div>
                <div class="col-md-3">
                    <label>Cargo</label>
                    <input type="text"
                           class="form-control"
                           name="cargo"
                           th:value="${param.cargo}">
                </div>
                <div class="col-md-3 d-flex align-items-end">
                    <button class="btn btn-primary w-100" type="submit">Buscar</button>
                </div>
            </form>

            <!-- Mensagem de erro para funcionário -->
            <div th:if="${mensagemErroFuncionario}" class="alert alert-danger">
                <span th:text="${mensagemErroFuncionario}"></span>
            </div>

            <!-- Dados do funcionário, se encontrado -->
            <div th:if="${funcionario != null}">
                <label>Código</label>
                <input type="text" class="form-control" readonly
                       th:value="${funcionario.codigoFuncionario}">

                <label>Cargo</label>
                <input type="text" class="form-control" readonly
                       th:value="${funcionario.cargo}">

                <label>Nome</label>
                <input type="text" class="form-control" readonly
                       th:value="${funcionario.usuario.nome}">

                <label>CPF</label>
                <input type="text" class="form-control" readonly
                       th:value="${funcionario.usuario.cpf}">

                <label>Data de Nascimento</label>
                <input type="text" class="form-control" readonly
                       th:value="${#temporals.format(funcionario.usuario.dataNascimento, 'dd/MM/yyyy')}">

                <label>Telefone</label>
                <input type="text" class="form-control" readonly
                       th:value="${funcionario.usuario.telefone}">

                <label>Nº de Contas Abertas</label>
                <input type="text" class="form-control" readonly
                       th:value="${numContasAbertasFuncionario}">

                <label>Desempenho (Média Movimentada)</label>
                <input type="text" class="form-control" readonly
                       th:value="${desempenhoMedioFuncionario}">
            </div>
        </div>

        <!-- CLIENTE -->
        <div class="tab-pane fade"
             id="cliente"
             role="tabpanel"
             th:classappend="${aba == 'cliente'} ? ' show active' : ''">

            <!-- Form de busca do cliente pelo CPF -->
            <form th:action="@{/atendente/consultar-saldo}" method="get" class="row g-2 mb-3">
                <input type="hidden" name="aba" value="cliente"/>
                <div class="col-md-4">
                    <label>CPF do Cliente</label>
                    <input type="text"
                           class="form-control"
                           name="cpfCliente"
                           th:value="${param.cpfCliente}">
                </div>
                <div class="col-md-3 d-flex align-items-end">
                    <button class="btn btn-primary w-100" type="submit">Buscar</button>
                </div>
            </form>

            <!-- Mensagem de erro para cliente -->
            <div th:if="${mensagemErroCliente}" class="alert alert-danger">
                <span th:text="${mensagemErroCliente}"></span>
            </div>

            <!-- Dados do cliente, se encontrado -->
            <div th:if="${cliente != null}">
                <label>Nome</label>
                <input type="text" class="form-control" readonly
                       th:value="${cliente.usuario.nome}">

                <label>CPF</label>
                <input type="text" class="form-control" readonly
                       th:value="${cliente.usuario.cpf}">

                <label>Data de Nascimento</label>
                <input type="text" class="form-control" readonly
                       th:value="${#temporals.format(cliente.usuario.dataNascimento, 'dd/MM/yyyy')}">

                <label>Telefone</label>
                <input type="text" class="form-control" readonly
                       th:value="${cliente.usuario.telefone}">

                <label>Score de Crédito</label>
                <input type="text" class="form-control" readonly
                       th:value="${cliente.scoreCredito}">

                <div class="section-title">Contas Ativas/Inativas</div>
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th>Tipo</th>
                        <th>Número</th>
                        <th>Status</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="c : ${contasCliente}">
                        <td th:text="${c.tipoConta}"></td>
                        <td th:text="${c.numeroConta}"></td>
                        <td th:text="${c.status}"></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div> <!-- fim tab-content -->
</div> <!-- fim container -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
